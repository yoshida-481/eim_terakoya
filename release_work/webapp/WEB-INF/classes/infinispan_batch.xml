<?xml version="1.0" encoding="UTF-8"?>
<infinispan
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="urn:infinispan:config:15.2 https://infinispan.org/schemas/infinispan-config-15.2.xsd"
	xmlns="urn:infinispan:config:15.2">

	<!-- ================================================================== -->
	<!-- バッチ処理用のキャッシュ設定                                       -->
	<!--   バッチ処理用の拡張TransactionManagerLookupを適用します。         -->
	<!--   UpdateLogキャッシュのみ有効にします。                            -->
	<!--   ストレージキャッシュは無効にします。                     -->
	<!-- ================================================================== -->

	<cache-container>
		<transport stack="tcp" node-name="${eimCacheNodeName}" />

		<serialization marshaller="org.infinispan.commons.marshall.JavaSerializationMarshaller">
			<allow-list>
				<regex>java.*</regex>
				<regex>jp.co.ctc_g.eim.framework2.*</regex>
			</allow-list>
		</serialization>

		<!-- 共通設定(キャッシュ無制限) -->
		<replicated-cache-configuration name="Common" mode="SYNC">
			<state-transfer timeout="9223372036854775807" />
		</replicated-cache-configuration>

		<!-- 共通設定(キャッシュしない設定) -->
		<replicated-cache-configuration name="NoCache" mode="SYNC">
			<memory max-count="0" />
		</replicated-cache-configuration>

		<!-- 共通トランザクション設定 -->
		<replicated-cache-configuration name="Common-Transaction" mode="SYNC">
			<locking isolation="READ_COMMITTED" />
			<!-- トランザクションタイムアウト時間:15分 -->
			<transaction auto-commit="false" mode="FULL_XA" complete-timeout="900000" />
			<state-transfer timeout="9223372036854775807" />
		</replicated-cache-configuration>

		<!-- システム管理情報用個別設定 -->
		<replicated-cache name="UpdateLog_ObjectType" configuration="Common-Transaction" />
		<replicated-cache name="Ref_UpdateLog_UpdatedPK_ObjectType" configuration="Common-Transaction" />

		<replicated-cache name="UpdateLog_Format" configuration="Common-Transaction" />
		<replicated-cache name="Ref_UpdateLog_UpdatedPK_Format" configuration="Common-Transaction" />

		<replicated-cache name="UpdateLog_Directory" configuration="Common-Transaction" />
		<replicated-cache name="Ref_UpdateLog_UpdatedPK_Directory" configuration="Common-Transaction" />

		<replicated-cache name="UpdateLog_AttributeType" configuration="Common-Transaction" />
		<replicated-cache name="Ref_UpdateLog_UpdatedPK_AttributeType" configuration="Common-Transaction" />

		<replicated-cache name="UpdateLog_User" configuration="Common-Transaction" />
		<replicated-cache name="Ref_UpdateLog_UpdatedPK_User" configuration="Common-Transaction" />

		<replicated-cache name="UpdateLog_Group" configuration="Common-Transaction" />
		<replicated-cache name="Ref_UpdateLog_UpdatedPK_Group" configuration="Common-Transaction" />

		<!-- オブジェクト用共通設定 -->
		<replicated-cache name="UpdateLog_Object" configuration="Common-Transaction" />
		<replicated-cache name="Ref_UpdateLog_UpdatedPK_Object" configuration="Common-Transaction" />

		<replicated-cache name="UpdateLog_File" configuration="Common-Transaction" />
		<replicated-cache name="Ref_UpdateLog_UpdatedPK_File" configuration="Common-Transaction" />
	</cache-container>
</infinispan>
