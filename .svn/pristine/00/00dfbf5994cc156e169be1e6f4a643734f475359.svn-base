<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:aop="http://www.springframework.org/schema/aop"
		xsi:schemaLocation="
			http://www.springframework.org/schema/beans
			http://www.springframework.org/schema/beans/spring-beans.xsd
			http://www.springframework.org/schema/aop
			http://www.springframework.org/schema/aop/spring-aop.xsd">

	<!-- ======================================================================================== -->
	<!-- Box連携用AOP定義                                                                        -->
	<!-- ======================================================================================== -->

	<!-- 宣言型トランザクションポイントカット設定 (Box連携処理) -->
	<aop:config>
		<aop:pointcut id="serviceOperation-box"
			expression="execution(* jp.co.ctc_g.eim.framework2.business.service.box.BoxArchiveJobService.*(..)) or
						execution(* jp.co.ctc_g.eim.framework2.business.service.box.PurgeArchivedJobService.*(..)) or
						execution(* jp.co.ctc_g.eim.framework2.presentation.web.controller.Box*Controller.*(..))"
						 />
		<aop:advisor advice-ref="txAdvice" order="1" pointcut-ref="serviceOperation-box" />
	</aop:config>

	<!-- ======================================================================================== -->
	<!-- Box連携用Bean定義                                                                        -->
	<!-- ======================================================================================== -->

	<!-- Service実装 -->
	<!-- ======================================================================================== -->

	<!-- Box連携API接続サービス -->
	<bean id="boxAPIConnectionService2" class="jp.co.ctc_g.eim.framework2.business.service.box.impl.BoxAPIConnectionServiceImpl">
		<property name="boxAPIConnectionDao" ref="boxAPIConnectionDao2"/>
		<property name="userDao" ref="userDaoLight2"/>

		<!-- BoxユーザーID -->
<!-- 		<property name="userId" value="z2180047@ctc-g.co.jp"/> -->

		<!-- (サーバー認証) アプリ構成設定JSONファイル配置場所 -->
		<!-- <property name="boxConfigLocation" value="classpath:box_config.json"/> -->

	</bean>

	<!-- Box連携ファイルサービス -->
	<bean id="boxFileService2" class="jp.co.ctc_g.eim.framework2.business.service.box.impl.BoxFileServiceImpl">
		<property name="objectService" ref="objectService2"/>
		<property name="formatService" ref="formatService2"/>
		<property name="fileAccessor" ref="fileAccessor2"/>
		<property name="fileDao" ref="fileDao2"/>
		<property name="boxFileDao" ref="boxFileDao2"/>
		<property name="boxArchiveInfoService" ref="boxArchiveInfoService2"/>
	</bean>

	<!-- Box連携フォルダサービス -->
	<bean id="boxFolderService2" class="jp.co.ctc_g.eim.framework2.business.service.box.impl.BoxFolderServiceImpl">
		<property name="boxFolderDao" ref="boxFolderDao2"/>
	</bean>

	<!-- Box保管Jobサービス -->
	<bean id="boxArchiveJobService2" class="jp.co.ctc_g.eim.framework2.business.service.box.impl.BoxArchiveJobServiceImpl">
		<property name="objectService" ref="objectServiceWithoutAttribute"/>
		<property name="fileDao" ref="fileDaoForArchiveJob"/>
		<property name="boxFileService" ref="boxFileService2"/>
		<property name="boxFolderService" ref="boxFolderService2"/>
		<property name="archiveConditionList">
			<list>
				<!-- オブジェクトタイプに設定されたフォーマットにBoxフォルダIDが指定されている -->
				<bean class="jp.co.ctc_g.eim.framework2.business.plugin.box.impl.SpecificFormatArchiveConditionPlugInImpl" />
				<!-- オブジェクトの更新日が指定日数よりも後であるものを除外する -->
				<bean class="jp.co.ctc_g.eim.framework2.business.plugin.box.impl.ElapsedDaysArchiveConditionPlugInImpl">
					<!-- 最大経過日数 -->
					<property name="maxDaysFromMDate" value="${BOX_INTEGRATION_MAX_DAYS_FROM_MDATE}"/>
				</bean>
				<!-- オブジェクトの更新日がアーカイブ完了日時より前であるものを除外する -->
				<bean class="jp.co.ctc_g.eim.framework2.business.plugin.box.impl.AlreadyArchivedArchiveConditionPlugInImpl" />
				<!-- 検索FW用 -->
				<!-- 全文インデックス作成待ちを除外する -->
				<bean class="jp.co.ctc_g.eim.framework2.business.plugin.box.impl.SearchIndexNotYetArchiveConditionPlugInImpl">
					<property name="dataTypeList">
						<list>
							<value>FILE</value>
							<value>ATTACHMENT</value>
						</list>
					</property>
				</bean>
			</list>
		</property>
	</bean>

	<!-- Box保管済ファイル削除Jobサービス -->
	<bean id="purgeArchivedJobService2" class="jp.co.ctc_g.eim.framework2.business.service.box.impl.PurgeArchivedJobServiceImpl">
		<property name="boxArchiveInfoService" ref="boxArchiveInfoService2" />
		<property name="objectService" ref="objectServiceWithoutAttribute" />
		<property name="fileAccessor" ref="fileAccessor2" />
	</bean>

	<!-- Box保管情報サービス -->
	<bean id="boxArchiveInfoService2" class="jp.co.ctc_g.eim.framework2.business.service.box.impl.BoxArchiveInfoServiceImpl">
		<property name="boxArchiveInfoDao" ref="boxArchiveInfoDao2" />
	</bean>

	<!-- Box連携用Beanが使用するService定義 -->
	<!-- ======================================================================================== -->

	<!-- Dao実装 -->
	<!-- ======================================================================================== -->

	<!-- Box連携API接続Dao -->
	<bean id="boxAPIConnectionDao2" class="jp.co.ctc_g.eim.framework2.integration.dao.box.impl.BoxAPIConnectionDaoImpl">
	</bean>

	<!-- BoxファイルDao -->
	<bean id="boxFileDao2" class="jp.co.ctc_g.eim.framework2.integration.dao.box.impl.BoxFileDaoImpl">
		<property name="boxAPIConnectionDao" ref="boxAPIConnectionDao2"/>
	</bean>

	<!-- BoxフォルダDao -->
	<bean id="boxFolderDao2" class="jp.co.ctc_g.eim.framework2.integration.dao.box.impl.BoxFolderDaoImpl">
		<property name="boxAPIConnectionDao" ref="boxAPIConnectionDao2"/>
	</bean>

	<!-- Box保管情報Dao -->
	<bean id="boxArchiveInfoDao2" class="jp.co.ctc_g.eim.framework2.integration.dao.box.impl.BoxArchiveInfoDaoImpl">
	</bean>

	<!-- Box連携用Beanが使用するDao定義 -->
	<!-- ======================================================================================== -->

	<!-- fileDao for Box保管Jobサービス -->
	<bean id="fileDaoForArchiveJob" parent="fileDao2">
		<property name="itemListForSingleTargetMethod">
			<list>
			</list>
		</property>
		<property name="itemListForMultiTargetMethod">
			<list>
				<value>FORMAT</value>
				<value>DIRECTORY</value>
			</list>
		</property>
	</bean>

	<!-- バッチ or JOB実装 -->
	<!-- ======================================================================================== -->

	<!-- Box保管JOB(ファイルアップロード) -->
	<bean id="boxArchiveJob" class="jp.co.ctc_g.eim.framework2.presentation.job.box.BoxArchiveJob">
		<property name="boxAPIConnectionService" ref="boxAPIConnectionService2" />
		<property name="boxArchiveJobService" ref="boxArchiveJobServiceForDoc" />
		<property name="jobControlService" ref="jobControlWithinTimeService" />
		<!-- アーカイブ実施スレッド数 -->
		<property name="threadNumber" value="${BOX_INTEGRATION_THREAD_NUM}" />
		<!-- アーカイブ実施企業アカウントメールアドレスリスト -->
		<property name="enterpriseUserIdList" value="${BOX_INTEGRATION_ENTERPRISE_USER_ID_LIST}" />
	</bean>

	<!-- Box保管済ファイル削除JOB -->
	<bean id="purgeArchivedJob" class="jp.co.ctc_g.eim.framework2.presentation.job.box.PurgeArchivedJob">
		<property name="purgeArchivedJobService" ref="purgeArchivedJobService2" />
		<property name="jobControlService" ref="jobControlWithinTimeService" />
	</bean>

</beans>